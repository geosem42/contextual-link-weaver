(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,n=window.wp.editPost,r=window.wp.components,i=window.wp.i18n,o=window.wp.element,s=window.wp.data,l=window.wp.apiFetch;var a=e.n(l);const c=window.ReactJSXRuntime,d=()=>(0,c.jsx)("span",{className:"dashicons dashicons-admin-links"});(0,t.registerPlugin)("link-weaver-plugin",{render:()=>{const[e,t]=(0,o.useState)(!1),[l,u]=(0,o.useState)([]),[p,x]=(0,o.useState)(""),{postContent:w,currentPostId:g,blocks:h}=(0,s.useSelect)(e=>({postContent:e("core/editor").getEditedPostContent(),currentPostId:e("core/editor").getCurrentPostId(),blocks:e("core/block-editor").getBlocks()}),[]),{replaceBlocks:k}=(0,s.useDispatch)("core/block-editor");return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.PluginSidebarMoreMenuItem,{target:"link-weaver-sidebar",icon:(0,c.jsx)(d,{}),children:(0,i.__)("Link Weaver","contextual-link-weaver")}),(0,c.jsx)(n.PluginSidebar,{name:"link-weaver-sidebar",title:(0,i.__)("Link Weaver","contextual-link-weaver"),children:(0,c.jsxs)(r.PanelBody,{title:(0,i.__)("Link Suggestions","contextual-link-weaver"),children:[(0,c.jsx)("p",{children:(0,i.__)("Click the button below to scan this post and generate internal link suggestions.","contextual-link-weaver")}),(0,c.jsx)(r.Button,{isPrimary:!0,onClick:()=>{w&&0!==w.trim().length?(t(!0),x(""),u([]),a()({path:"/contextual-link-weaver/v1/suggestions",method:"POST",data:{content:w,post_id:g}}).then(e=>{Array.isArray(e)?u(e):x((0,i.__)("The API returned an unexpected format.","contextual-link-weaver")),t(!1)}).catch(e=>{x(e.message||(0,i.__)("An unknown error occurred.","contextual-link-weaver")),t(!1)})):x((0,i.__)("Cannot generate suggestions for an empty post.","contextual-link-weaver"))},isBusy:e,children:e?(0,i.__)("Generating...","contextual-link-weaver"):(0,i.__)("Generate Suggestions","contextual-link-weaver")}),e&&(0,c.jsx)(r.Spinner,{style:{marginTop:"10px"}}),p&&(0,c.jsx)("p",{style:{color:"red",marginTop:"10px"},children:p}),l&&l.length>0&&(0,c.jsxs)("div",{style:{marginTop:"20px"},children:[(0,c.jsx)("h4",{style:{marginBottom:"10px",fontSize:"14px"},children:(0,i.__)("Suggestions:","contextual-link-weaver")}),(0,c.jsx)("ul",{style:{listStyle:"none",margin:0,padding:0},children:l.map((e,t)=>(0,c.jsxs)("li",{style:{border:"1px solid #ddd",padding:"12px",borderRadius:"4px",marginBottom:"10px"},children:[(0,c.jsxs)("p",{style:{margin:"0 0 8px 0",fontSize:"13px"},children:[(0,c.jsx)("strong",{children:(0,i.__)("Phrase:","contextual-link-weaver")}),(0,c.jsx)("br",{}),(0,c.jsxs)("span",{style:{fontStyle:"italic"},children:['"',e.anchor_text,'"']})]}),(0,c.jsxs)("p",{style:{margin:"0 0 12px 0",fontSize:"12px",color:"#555"},children:[(0,c.jsx)("strong",{children:(0,i.__)("Link to Post:","contextual-link-weaver")}),(0,c.jsx)("br",{}),e.title]}),(0,c.jsx)(r.Button,{isSecondary:!0,isSmall:!0,onClick:()=>((e,t)=>{let n=!1,r=null;const i=h.map(i=>{if(n||!i.attributes.content)return i;let o="";if("string"==typeof i.attributes.content)o=i.attributes.content;else{if("object"!=typeof i.attributes.content||!i.attributes.content.originalHTML)return i;o=i.attributes.content.originalHTML}const s=`<a href="${t}" class="clw-inserted-link">${e}</a>`;if(o.includes(e)&&!o.includes(s)){const t=o.replace(e,s),l={...i.attributes,content:t};return r=i.clientId,n=!0,{...i,attributes:l}}return i});if(n&&r){const t=document.querySelector(".editor-styles-wrapper");t&&new MutationObserver((e,t)=>{const n=document.querySelector(`[data-block="${r}"]`);if(n){n.scrollIntoView({behavior:"smooth",block:"center"});const e=n.querySelector("a.clw-inserted-link");e&&(e.classList.add("clw-highlight-link"),e.classList.remove("clw-inserted-link")),t.disconnect()}}).observe(t,{childList:!0,subtree:!0}),k(h.map(e=>e.clientId),i),u(l.filter(t=>t.anchor_text!==e))}else alert(`Could not find the exact phrase "${e}" in your content. It might be split across multiple paragraphs.`)})(e.anchor_text,e.url),children:(0,i.__)("Insert Link","contextual-link-weaver")})]},t))})]})]})})]})}})})();